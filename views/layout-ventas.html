{# Heredando la plantilla principal #}


{% extends 'default_layout.html' %}

{% block extraCSS %}

{% endblock %}

{% block javascripts %}
		<!-- JS para esta página. -->
		<script type="text/javascript" src="js_libs/jquery-mask/jquery.inputmask.bundle.js"></script>
		<!-- JS BUSQUEDA DE PROVEEDORES Y PRODUCTOS. -->
		<script type="text/JavaScript" src="js_libs/DatosBuscarClienteEmpresa.js"></script> <!-- buscar datos en la tabla productos  y austed el PRECIO DE VENTA-->
		<script type="text/JavaScript" src="js_libs/DatosBuscarProductosVentas.js"></script> <!-- buscar datos en la tabla productos  y funciones sobre el detalle de
		la venta como ACTUALIZAR, cantidad, precio y otros-->
		<!-- JS VENTAS. -->
		<script type="text/JavaScript" src="js_libs/cargar-datos-ventas.js"></script> <!-- Rellena los SELECT necesarios en venta -->
		<script type="text/JavaScript" src="js_libs/DatosVentas.js"></script> <!-- serviara para guardar la información de la venta -->
		<!-- JS CATALOGO productos. -->
		<script type="text/javascript" src="js_libs/CatalogoClientes.js"></script>
		<script type="text/JavaScript" src="js_libs/cargar-datos-clientes.js"></script> <!-- Rellena los SELECT necesarios en venta -->
		<script type="text/javascript" src="js_libs/formato-moneda.js"></script>
		<script type="text/javascript" src="js_libs/default.js"></script>
		
		<script type="text/javascript">
				/* VALIDAR EL ENVIO DEL FORMULARIO. */
					function validar(){
					/*	var numero_factura_ = false;
						accion = "VerificarNumeroFactura";
                        codigo_tipo_factura = $("#lstTipoFactura").val();
						var numero_factura = $("#txtNumeroFactura").val();
						////
						////	CAMBIAR NUMERO DE FACTURAL REAL.
						////
								$.post("includes/cargar_numero_factura_real.php", {codigo_tipo_factura: codigo_tipo_factura},
									function(data) {
										NumeroFacturaReal = data[0].numero_factura_real;
										numero_fin = data[0].numero_fin;
										$("label[for='NumeroFacturaReal']").text(NumeroFacturaReal);
								///
								/// VERIFICAR SI EL NUMERODE FACTURA ES MAYOR AL CREADO.
								///
								/////////// VERIFICAR EN LA TABLA FACTURAS VENTAS.
								$.post("php_libs/soporte/DetalleFacturaTemp.php", {codigo_tipo_factura: codigo_tipo_factura, accion: accion, numero_factura: numero_factura, numero_factura_real: NumeroFacturaReal},
											function(response){														
												if(response.mensaje === "Si Registro"){
													alertify.error("Número de Factura Ya Existe");
													$("#goGuardarDetalleFactura").attr("disabled", "disabled");
													$("#GrupoBuscarProducto").attr("disabled", "disabled");
													$("#goEliminarDetalleFactura").attr("disabled", "disabled");
													$("#BotonBuscarProducto").attr("disabled", "disabled");
													$("#txtNumeroFactura").val(""); $("#txtNumeroFactura").focus();
														numero_factura_ = false;

												}
												
												 if(response.mensaje === "No Registro"){
													if(parseInt(numero_factura) > parseInt(numero_fin)){
														alertify.error("Número de Factura Ingresado es Mayor al Configurado --> "+numero_fin+" # factura "+numero_factura);
														$("#goGuardarDetalleFactura").attr("disabled", "disabled");
														$("#GrupoBuscarProducto").attr("disabled", "disabled");
														$("#BotonBuscarProducto").attr("disabled", "disabled");
														$("#txtNumeroFactura").val(""); $("#txtNumeroFactura").focus();
															numero_factura_ = true;

													}else{
														$("#goGuardarDetalleFactura").removeAttr("disabled");
														$("#GrupoBuscarProducto").removeAttr("disabled");
														$("#goEliminarDetalleFactura").removeAttr("disabled");
														$("#BotonBuscarProducto").removeAttr("disabled");
														$("label[for='NumeroFacturaReal']").text(NumeroFacturaReal);
															numero_factura_ = false;
													}
												}
								}, "json");
						}, "json");												
						
						*/// Evaluar
					if($("#ControlProductos").val() == 0){
										//alert("La Factura no tiene productos.");
										alertify.error("La factura no tiene Productos.");
										return false;
					}else{
						/*if(numero_factura_ == true){
							return true;
						}else{*/
							return true;
						//}
					//}
					}	
				}
			// VALIDAR LOS ENTER EN EL FORMULARIO.
			$(document).ready(function() {
				$('form').keypress(function(e){   
				  if(e == 13){
					return false;
				  }
				});
		  
				$('input').keypress(function(e){
				  if(e.which == 13){
					return false;
				  }
				});
				
				$("#txtNumeroFactura").inputmask("integer",{
					autoGroup: true
				});
				
				$("#txtFechaCreacion").datetimepicker({
					format: 'DD/MM/YYYY'
					});
				
			});
		</script>
{% endblock %}

{% block contenidos %}
<div class="container-fluid">
	<div class="row mt-1 text-dark">
			<div class="col">
				<ul class="nav nav-tabs">
					<li class="nav-item">
						<a href="#tab1" class="nav-link active" data-toggle="tab"><span class="fa fa-cart-arrow-down"></span> Ventas</a>
					</li>
				</ul>

				<div class="tab-content">
					<div class="tab-pane active" id="tab1" role="tabpanel">
						<div class="row">
								<div class="col col-md-12 col-lg-12 col-xl-12">
									<form method="" name="formFacturaVentas" id="formFacturaVentas" role="form">
										<!-- INPUT OCULTOS -->
											<input type="hidden" id="accion_factura" name="accion_factura" value = "GuardarFacturaVentas" class="{required:true}">
											<input type="hidden" id="txtCodigoCliente" name="txtCodigoCliente" value = "">
											<input type="hidden" id="estado_factura" name="estado_factura" value = "01">
											<input type="hidden" id="txtTotalVenta" name="txtTotalVenta" value = "0" required>
											<input type="hidden" id="txtTotalVentaDescuento" name="txtTotalVentaDescuento" value = "0">
											<input type="hidden" id="lstLineaFactura" name="lstLineaFactura" value = "50">
											<input type="hidden" id="ControlProductos" name="ControlProductos" value = "0">
										<div class="form-group row">
											<!-- BOTON DESPLEGABLES PROVEEDORES-->
											<div class="col-12 col-md-12 col-lg-2 col-xl-2 border border-primary d-flex justify-content-between">
												<div class="btn-group btn-group-sm" role="group">
													<button type="button" class="btn btn-success" id="BotonBuscarClienteEmpresa">Cliente/Empresa</button>
													<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
													  <span class="sr-only">Toggle Dropdown</span>
													</button>
													<div class="dropdown-menu">
													  <a class="dropdown-item" href="#" id="goBuscarClienteEmpresa"><span class="fa fa-search"></span> Buscar</a>
													  <a class="dropdown-item" href="#" id="NuevoCliente"><span class="fa fa-file"></span> Nuevo</a>
													</div>
												 </div>
												<button type="button" class="btn btn-info btn-md" id="goEditarClienteEmpresa" disabled="disabled" data-toggle="tooltip" title="Editar Información del Cliente"><span class="	fa fa-address-card"></span></button>
											</div>
											<div class="col-12 col-md-12 col-lg-3 col-xl-3 border border-primary rounded">
												<h6><span for="txtNombreClienteEmpresa">Nombre Cliente </span><label class="badge badge-secondary" for="lblCodigoClienteEmpresa"> Código</label></h6>
											</div>
											<!-- BOTON DESPLEGABLES PRODUCTOS -->
											<div class="col-12 col-md-12 col-lg-2 col-xl-4 border border-primary d-flex justify-content-between">
												<button type="button" class="btn btn-warning btn-md" id="goEliminarDetalleFactura" disabled="disabled" data-toggle="tooltip" title="Elimina los Produtos"><span class="fa fa-trash"></span> Borrar Detalle Factura</button>
												<div>
													<label class="text-dark">Nº de Productos Ingresados :</label>
													<label class="text-dark" for="NumeroProductos"></label>
												</div>
												<div class="btn-group btn-group-sm" role="group">													
													<button type="button" class="btn btn-success" id="BotonBuscarProducto" disabled="disabled">Productos</button>
													<button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="GrupoBuscarProducto" disabled>
													  <span class="sr-only">Toggle Dropdown</span>
													</button>
													<div class="dropdown-menu">														
													  <a class="dropdown-item" href="#" id="goBuscarProducto"><span class="fa fa-search"></span> Buscar</a>
													</div>
												 </div>
											</div>
											<div class="col-12 col-md-12 col-lg-3 col-xl-3 border border-primary rounded d-flex justify-content-end">
												<button type="submit" class="btn btn-primary btn-md" id="goGuardarDetalleFactura" disabled="disabled" data-toggle="tooltip" title="Guarda e Imprimi la Factura" onclick="return validar()"><span class="fa" style="font-size: 24px;">&#xf0c7;</span> Guardar</button>
											</div>
										</div>
										<!-- FORM GRUUP INF. DE LA FACTURA, TABLA DE DETALLE DE PRODUCTOS Y SUMAS -->
												<div class="form-group form-group-sm row">
													<div class="col-12 col-md-12 col-lg-3 col-xl-2 border border-primary bg-secondary rounded info-factura" style="height: 300px;">
														<!-- LEYENDA -->
														<div class="p-1 mb-1 bg-secondary text-white text-center"><h4>FACTURA</h4></div>
														<!-- TIPO DE FACTURA -->
														<div class="input-group input-group-sm mb-1">
															<div class="input-group-prepend">
																<span class="input-group-text">Tipo Factura</span>
															</div>
															<select name="lstTipoFactura" id="lstTipoFactura" class="form-control form-control-sm"></select>																					
														</div>
														<!-- NUMERO DE FACTURA -->
														<div class="input-group input-group-sm">
															<div class="input-group-prepend">
																<span class="input-group-text">N° Factura</span>
															</div>
															<div class="input-group-prepend">
																<label for="NumeroFacturaReal" class="input-group-text text-primary"></label>
															</div>
															<input type="text" name="txtNumeroFactura" id="txtNumeroFactura" class="form-control form-control-sm text-right font-weight-bold text-danger" min="1" step="1" required required maxlength="12" style="font-size: 18px;" disabled="disabled">
														</div>
														<!-- FECHA -->
														<div class="input-group input-group-sm">
															<div class="input-group-prepend">
																<span class="input-group-text">Fecha</span>
															</div>
															<input type="date" name="txtFechaVenta" id="txtFechaVenta" class="form-control form-control-sm text-right">
														</div>
														<!-- FORMA DE PAGO -->
														<div class="input-group input-group-sm mb-1">
															<div class="input-group-prepend">
																<span class="input-group-text">Forma de Pago</span>
															</div>
															<select name="lstFormaPago" id="lstFormaPago" value="01" class="form-control form-control-sm"></select>																					
														</div>
														<!-- DESCUENTO -->
														<div class="input-group input-group-sm mb-2">
															<div class="input-group-prepend">
																<span class="input-group-text">Descuento</span>
															</div>
															<select name="lstDescuentoSVT" id="lstDescuentoSVT" class="form-control form-control-sm"></select>																					
														</div>
														<!-- VENDEDOR -->
														<div class="input-group input-group-sm">
															<div class="input-group-prepend">
																<span class="input-group-text">Vendedor</span>
															</div>
															<select name="lstCodigoVendedor" id="lstCodigoVendedor" class="form-control form-control-sm"></select>																					
														</div>
													</div> <!-- FIN DEL DIV DE INFORMACION DE LA FACTURA -->
													<div class="col-12 col-md-12 col-lg-6 col-xl-7 border border-dark rounded" style="height: 300px; overflow-y: scroll;">
														<table class="table table-responsive table-striped table-sm" id="DetalleFacturaTemp">
															<thead class="thead-inverse bg-dark text-white table-condensed table-striped">
																<tr>
																	<th>N°</th>
																	<th>Id</th>
																	<th>Código</th>
																	<th>Descripción</th>
																	<th>Cantidad</th>
																	<th>Unidad de Medida</th>
																	<th>Precio Unitario $</th>
																	<th>Exentas $</th>
																	<th>Gravadas $</th>
																	<th></th>
																	<th></th>
																</tr>
															</thead>
																<tbody id="listaProductosTemp">
																</tbody>
															</table>
													</div>
													<div class="col-12 col-md-12 col-lg-3 col-xl-3 border border-primary bg-default rounded" style="height: 400px;">
														<div class="p-1 mb-1 bg-secondary text-white text-center"><h4>SUMAS</h4></div>
														<table class="table table-striped table-sm" id="TablaSumas">
															<thead>
																<tr>
																	<th></th>
																	<th style="text-align: center;">Exentas</th>
																	<th style="text-align: center;">Gravadas</th>
																</tr>
															</thead>
															<tbody>
																<tr>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0">
																		Sumas
																	</td>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0" style="text-align: right; font-size: 16px; color: green;"><b>$ <label for="SumasVentasExentas"></b></label></td>
																	<td style="text-align: right; font-size: 16px; color: brown;"><b>$ <label for="SumasVentasGravadas"></b></label></td>
																</tr>
																<tr>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0">
																		Sub-total
																	</td>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0"></td>
																	<td style="text-align: right; font-size: 16px; color: brown;"><b>$ <label for="SubTotal"></label></b></td>
																</tr>
																<tr>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0">
																		(+) IVA
																	</td>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0"></td>
																	<td style="text-align: right; font-size: 16px; color: red;"><b>$ <label for="IVA"></label></b></td>
																</tr>
																<tr>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0">
																		Exentas
																	</td>
																	<td class="border border-dark border-top-0 border-bottom-0 border-left-0"></td>
																	<td style="text-align: right; font-size: 16px; color: green;"><b>$ <label for="SumasVentasExentas"></label></b></td>
																</tr>
																<tr  class="border border-dark border-left-0 border-right-0">
																	<td>
																		TOTAL
																	</td>
																	<td></td>
																	<td style="text-align: right; font-size: 18px; color: blue;">$ <b><label for="Total"></b></label></td>
																</tr>
																<tr  class="border border-dark border-left-0 border-right-0">
																	<td>
																		Descuento
																	</td>
																	<td></td>
																	<td style="text-align: right; font-size: 18px; color: orange;">$ <b><label for="Descuento"></b></label></td>
																</tr>
																<tr  class="border border-dark border-left-0 border-right-0">
																	<td>
																		Toral - Descuento
																	</td>
																	<td></td>
																	<td style="text-align: right; font-size: 18px; color: blue;">$ <b><label for="VentaMenosDescuento"></b></label></td>
																</tr>														
															</tbody>
														</table>
													</div> <!-- SUMAS -->
												</div> <!-- FORM GROUP PARA INFORMACION DE LA FACTURA, TABLA Y SUMAS-->
									</form>					
								</div> <!-- col -->
						</div> <!-- row -->
					</div> <!-- tab 1 -->
				</div> <!-- tab content -->
			</div> <!-- col -->
		</div> <!-- row -->
</div> <!-- container -->
<!-- plantilla que contiene el Ventana Buscar Producto. -->
		{% include 'VentanaBuscarProductoVenta.html' %}
<div class="row mt-3 text-dark">
			<div class="col">
			<div class="modal fade" data-backdrop="static" data-keyboard="false" id="VentanaModificarAjusteVenta" tabindex="-2" role="dialog" aria-labelledby="VentanaModificarAjusteVenta" aria-hidden="true">
					<div class="modal-dialog modal-sm">
						<div class="modal-content">
							<div class="modal-header modal-header-info">
								<h6 class="modal-title" id=""><span class="fa fa-edit"></span>¿Editar Cantidad o Precio Venta?</h6>
								<button class="close" data-dismiss="modal" aria-label="Cerrar">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>

							<div class="modal-body">
								<div class="container-fluid">
									<div class="row">
										<div class="col-12">
												<form  action="" method="post" name="formAjusteVenta" id="form" role="form">
													<div class="form-group row">
														<div class="input-group mb-2">
															<div class="input-group-prepend">
																<span class="input-group-text">Cantidad</span>
															</div>
															<input type="number" name="txtCantidadVentaAjusteModificar" id="txtCantidadVentaAjusteModificar" class="form-control" value="1">
														</div>
														<!-- LISTA DE PRECIOS, SEGUN PORCENTAJES. -->
														<div class="input-group input-group-sm mb-2">
															<div class="input-group-prepend">
																<span class="input-group-text">Lista de Precios</span>
															</div>
															<select name="lstTipoPrecio" id="lstTipoPrecio" value="01" class="form-control form-control"></select>																					
														</div>														
														<div class="input-group mb-2">
															<div class="input-group-prepend">
																<span class="input-group-text">Precio Venta</span>
															</div>
															<input type="text" name="txtPrecioVentaAjusteModificar" id="txtPrecioVentaAjusteModificar" class="form-control" onkeypress="return NumCheck(event, this);">
														</div>
													</div>
												</form>
										</div>
									</div>
								</div>
							</div>

							<div class="modal-footer">
								<button class="btn btn-success" id="goActualizarAjusteVenta" value="SiActualizarRegistro">Aceptar</button>
								<button class="btn btn-default" data-dismiss="modal">Cerrar</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
<!-- plantilla que contiene el Ventana Catalogo Clientes. -->
		{% include 'VentanaBuscarClienteEmpresa.html' %}
<!-- plantilla que contiene el Ventana Crear Nuevo Cliente. -->
		{% include 'VentanaClientesEmpresa.html' %}
<!-- plantilla que contiene el menú principal. -->
		{% include 'layout-loading.html' %}
<!--		VENTANA MODAL - MODIFICAR AJUSTE -->  		
{% endblock %}

{% block menu %}
<!-- plantilla que contiene el menú principal. -->
		{% include 'layout-menu.html' %}
{% endblock %}
 
{% block loginUser %}
	<!--	{% include 'layout-login-user.html' %} -->
{% endblock %}
